!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):a.amdWeb=b(a.b)}(this,function(a){"use strict";var b,c;c={fps:60,columns:0,rows:0,frames:0,frameWidth:null,frameHeight:null,sprites:[],ratio:1.5,autoPlay:!1,loop:!1,loopDelay:0};var d=Date.now(),e=function(){return(d++).toString(36)};return b=function(b,d){this.$el=a(b),this.options=a.extend({},c,d),this.id=this.options.id||this.$el.attr("id")||e(),this.cache=[],this.state={loaded:!1,playing:!1,ended:!1},this.init()},b.prototype={currentFrame:0,images:[],init:function(){var a=this;this.canvasSupported()&&(this.loadSprites(function(){a.setState("loaded",!0),a.createCanvas(),a.options.autoPlay&&a.play()}),this.enable(),this.setHeight())},enable:function(){a(window).on("resize."+this.id,a.proxy(this,"onResize"))},disable:function(){a(window).off("."+this.id)},destroy:function(){this.$el.empty(),this.disable()},canvasSupported:function(){return void 0===document.createElement("canvas").getContext?!1:navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(GT-P5110)|(Windows Phone (OS 7))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)?!1:!0},createCanvas:function(){var b=a('<canvas class="sprite-canvas" id="canvas-'+this.id+'"></canvas>');this.$el.append(b),this.canvas=this.$el.find("#canvas-"+this.id),this.context=this.canvas[0].getContext("2d"),this.setCanvasSize()},setState:function(a,b){this.state[a]!==b&&(this.state[a]=b,this.$el.trigger(a,b))},onResize:function(a){var b=this;this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){b.setCanvasSize(),b.setHeight(),b.setFrame(b.currentFrame)},100)},setHeight:function(){var a=this.options.ratio;this.$el.height(this.$el.width()/a)},setCanvasSize:function(){if(this.$el.find("canvas").length){var a=this.$el.width(),b=a/this.options.ratio;this.$el.find("canvas").attr("width",a).attr("height",b)}},loadSprites:function(b){for(var c=this.options.sprites,d=0;d<c.length;d++){var e,f;e=c[d],f=new Image,a(f).one("load",a.proxy(this,"onSpriteLoaded",b)).one("error",a.proxy(this,"onSpriteError")),f.src=e}},onSpriteLoaded:function(b,c){this.cache.push(c.target),this.options.sprites.length===this.cache.length&&a.isFunction(b)&&b()},onSpriteError:function(a){throw"Sprite failed to load"},setFrame:function(a){var b=this,c=Math.floor(a/(this.options.columns*this.options.rows)),a=a%(this.options.columns*this.options.rows),d=this.getCachedImage(c),e=this.options.frameWidth*(a%this.options.columns),f=this.options.frameHeight*Math.floor(a/this.options.columns),g=this.options.frameWidth,h=this.options.frameHeight,i=0,j=0,k=this.options.frameWidth*(this.canvas.width()/this.options.frameWidth),l=this.options.frameHeight*(this.canvas.width()/this.options.frameWidth);b.context.drawImage(d,e,f,g,h,i,j,k,l)},getCachedImage:function(a){var b=this.options.sprites[a],c=this.cache.filter(function(a){return a.src.indexOf(b)>-1});return c[0]},clearCanvas:function(){this.context&&this.context.clearRect(0,0,this.canvas.width(),this.canvas.height())},hasTransform:function(){for(var a="transform WebkitTransform MozTransform OTransform msTransform".split(" "),b=document.createElement("div"),c=0;c<a.length;c++)if(b&&void 0!==b.style[a[c]])return a[c];return!1},goToAndPlay:function(a){this.currentFrame=a,this.play()},play:function(){var b=1e3/this.options.fps;if(this.setState("playing",!0),this.setState("ended",!1),this.currentFrame>=this.options.frames&&!this.options.loop)return this.setState("ended",!0),void this.setState("playing",!1);if(this.currentFrame>=this.options.frames&&this.options.loop){if(this.options.loopDelay>0)return this.currentFrame=0,void setTimeout(a.proxy(this,"play"),this.options.loopDelay);this.currentFrame=0}this.setFrame(this.currentFrame),this.currentFrame++,this.ticker=setTimeout(a.proxy(this,"play"),b)},pause:function(){this.ticker&&(clearInterval(this.ticker),this.setState("playing",!1))}},b});